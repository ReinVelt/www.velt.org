# CyberQuest â€” Complete Game Flow Analysis

> **Generated by:** Static analysis of all 23 scene files + engine code  
> **Scope:** Every `loadScene()`, `setStoryPart()`, `setFlag()`, `getFlag()`, hotspot transition, and `onEnter`/`onExit` callback

---

## Table of Contents

1. [Story Part Progression](#1-story-part-progression)
2. [Complete Playthrough Path](#2-complete-playthrough-path)
3. [Per-Scene Breakdown](#3-per-scene-breakdown)
4. [Flag Registry](#4-flag-registry)
5. [Dead Ends & Navigation Issues](#5-dead-ends--navigation-issues)
6. [Unreachable Scenes](#6-unreachable-scenes)
7. [Flag Mismatches & Unused Flags](#7-flag-mismatches--unused-flags)
8. [Story Part Gaps](#8-story-part-gaps)
9. [Item Inventory Flow](#9-item-inventory-flow)
10. [Scene Graph (Adjacency)](#10-scene-graph-adjacency)

---

## 1. Story Part Progression

| Part | Set Where | What Happens |
|------|-----------|-------------|
| 0 | Engine default | Game start |
| 1 | `home/scene.js:58` | Made espresso |
| 2 | `mancave/scene.js:151` | SSTV transmission received |
| 3 | `mancave/scene.js:125` | Message decoded |
| 4 | `mancave/scene.js:332` | Frequency tuned |
| 5 | `mancave/scene.js:48` | Second transmission received |
| 6 | `mancave/scene.js:69` | Second message decoded |
| 7 | `driving/scene.js:424` | Driving to Klooster |
| 8 | `mancave/usb-analysis.js:487` | USB stick analysed |
| 9 | `mancave/dilemma.js:54` | Dilemma acknowledged / ally search begins |
| 10 | `mancave/ally-recruitment.js:213` | All allies contacted |
| 11 | `mancave/volkov-investigation.js:74` | Volkov investigation started |
| 12 | `mancave/volkov-investigation.js:207` | Kubecka contacted |
| 13 | `mancave/volkov-investigation.js:297` | Zerfall discovered |
| 14 | `mancave/volkov-investigation.js:334` | Further investigation complete |
| 15 | `mancave/eva-reveal.js:301` | Eva identified |
| 16 | `mancave/eva-contact.js:53` | Eva contacted |
| 17 | `driving/scene.js:459` | Driving to facility (infiltration night) |
| 18 | `facility/scene.js:264` | Gate opened at facility |
| 19 | `facility_server/scene.js:866` | Server room entered / evidence gathered |
| 20 | `facility_server/scene.js:1170` | Operation Zerfall neutralised |

**No gaps.** All values 0â€“20 are accounted for.

---

## 2. Complete Playthrough Path

```
intro â”€â”€â†’ home â”€â”€â†’ livingroom â”€â”€â†’ tvdocumentary â”€â”€â†’ livingroom â”€â”€â†’ home
                                                                     â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
                   mancave â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â• [CENTRAL HUB] â•â•â•â•â•â•â•â•â•â•â•—
                      â”‚                                              â•‘
                      â”œâ”€â”€ sdr_bench â†’ (back) mancave                 â•‘
                      â”œâ”€â”€ videocall â†’ (back) mancave                 â•‘
                      â”œâ”€â”€ planboard â†’ (back) mancave                 â•‘
                      â”œâ”€â”€ regional_map â”€â”€â”¬â”€â”€ dwingeloo               â•‘
                      â”‚                  â””â”€â”€ westerbork_memorial      â•‘
                      â”œâ”€â”€ garden â”€â”€â”€â”€ volvo â”€â”€â”¬â”€â”€ klooster            â•‘
                      â”‚                       â”œâ”€â”€ astron              â•‘
                      â”‚                       â”œâ”€â”€ dwingeloo           â•‘
                      â”‚                       â”œâ”€â”€ westerbork_memorial â•‘
                      â”‚                       â””â”€â”€ facility            â•‘
                      â””â”€â”€ home (door)                                â•‘
                                                                     â•‘
  klooster â”€â”€â”€â†’ car_discovery â”€â”€â”€â†’ driving(home) â”€â”€â†’ mancave â•â•â•â•â•â•â•â•
  astron â”€â”€â”€â†’ driving_day(home_from_astron) â”€â”€â†’ mancave â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                                     
  garden/volvo â†’ driving(facility) â†’ facility â†’ facility_interior    
                                                    â”‚                
                                            facility_server          
                                                    â”‚                
                                                debrief              
                                                    â”‚                
                                                epilogue             
                                                    â”‚                
                                                credits              
                                                    â”‚                
                                          window.location.reload()   
```

### Critical Path (minimum scenes for completion)

```
intro â†’ home â†’ livingroom â†’ tvdocumentary â†’ livingroom â†’ home â†’ mancave â†’
  [mancave: receive SSTV, decode, tune freq, 2nd transmission, decode] â†’
  sdr_bench (decode SSTV) â†’ mancave â†’
  [mancave: check email, klooster_unlocked] â†’
  garden â†’ volvo(klooster) â†’ driving â†’ klooster â†’
  car_discovery â†’ driving(home) â†’ mancave â†’
  [mancave: USB analysis, dilemma, ally recruitment, Volkov investigation,
   Eva reveal, Eva contact, quest: infiltrate_facility] â†’
  garden â†’ volvo(astron) â†’ driving_day â†’ astron â†’ driving_day(home) â†’ mancave â†’
  garden â†’ volvo(facility) â†’ driving â†’ facility â†’ facility_interior â†’
  facility_server â†’ debrief â†’ epilogue â†’ credits â†’ [reload]
```

---

## 3. Per-Scene Breakdown

### intro
| Property | Value |
|----------|-------|
| **File** | `scenes/intro/scene.js` (1481 lines) |
| **onEnter** | âœ… Multi-act cinematic prologue |
| **onExit** | â€” |
| **Transitions OUT** | `game.loadScene('home')` at end of cinematic |
| **Transitions IN** | Game start |
| **setStoryPart** | â€” |
| **Flags set** | â€” |
| **Flags checked** | â€” |

### home
| Property | Value |
|----------|-------|
| **File** | `scenes/home/scene.js` (590 lines) |
| **onEnter** | â€” (no explicit onEnter, using hotspots) |
| **onExit** | â€” |
| **Transitions OUT** | `livingroom` (hotspot `door-livingroom`), `mancave` (hotspot `door-mancave`, gated by `tv_documentary_watched`), `garden` (hotspot `door-garden`) |
| **Transitions IN** | `intro`, `livingroom`, `garden`, `mancave` (hotspot `door-house`) |
| **setStoryPart** | `1` (making espresso) |
| **Flags set** | `made_espresso` |
| **Flags checked** | `made_espresso`, `tv_documentary_watched` |

### livingroom
| Property | Value |
|----------|-------|
| **File** | `scenes/livingroom/scene.js` (~220 lines) |
| **onEnter** | âœ… Shows dogs, sets `visited_livingroom` |
| **onExit** | âœ… Removes NPC characters |
| **Transitions OUT** | `home` (hotspot `to_home`), `tvdocumentary` (hotspot `tv`, via `game.loadScene` after dialogue) |
| **Transitions IN** | `home`, `tvdocumentary` |
| **setStoryPart** | â€” |
| **Flags set** | `visited_livingroom`, `saw_tv_documentary`, `talked_to_ies`, `dog_interactions`, `post_documentary_reminder_shown`, `fireplace_interactions`, `pug_interactions` |
| **Flags checked** | `saw_tv_documentary`, `talked_to_ies`, `tv_documentary_watched`, `documentary_completed_once`, `post_documentary_reminder_shown`, `visited_livingroom` |

### tvdocumentary
| Property | Value |
|----------|-------|
| **File** | `scenes/tvdocumentary/scene.js` (1213 lines) |
| **onEnter** | âœ… Calls `showDocumentaryOverlay(game)` |
| **onExit** | â€” |
| **Transitions OUT** | `livingroom` (end of documentary + skip button) |
| **Transitions IN** | `livingroom` (TV hotspot) |
| **setStoryPart** | â€” |
| **Flags set** | `tv_documentary_watched`, `documentary_completed_once` |
| **Flags checked** | â€” |

### mancave
| Property | Value |
|----------|-------|
| **File** | `scenes/mancave/scene.js` (824 lines) + 6 sub-modules |
| **onEnter** | âœ… Sets `visited_mancave`, random incoming calls |
| **onExit** | â€” |
| **Transitions OUT** | `sdr_bench`, `videocall`, `garden` (2 doors), `planboard`, `regional_map`, `home` (door-house) |
| **Transitions IN** | `home`, `garden`, `sdr_bench`, `videocall`, `planboard`, `regional_map`, `driving` (destination='home'/'home_from_astron'), `driving_day` (destination='home_from_astron') |
| **setStoryPart** | 2, 3, 4, 5, 6 (main scene); 8, 9, 10, 11, 12, 13, 14, 15, 16 (sub-modules) |
| **Flags set** | `checked_email`, `sstv_transmission_received`, `message_decoded`, `frequency_tuned`, `military_frequency`, `second_transmission_ready`, `second_message_decoded`, `klooster_unlocked`, `espresso_count`, `visited_mancave` |
| **Flags set (sub-modules)** | `usb_analyzed`, `viewed_schematics`, `evidence_unlocked`, `started_ally_search`, `contacted_allies`, `henk_contacted`, `cees_contacted`, `astron_unlocked`, `jaap_contacted`, `all_allies_contacted`, `volkov_investigated`, `contacted_kubecka`, `discovered_zerfall`, `identified_eva`, `eva_contacted` |
| **Flags checked** | `second_transmission_ready`, `second_message_decoded`, `sstv_transmission_received`, `message_decoded`, `frequency_tuned`, `checked_email`, `evidence_unlocked`, `started_ally_search`, `contacted_allies`, `all_allies_contacted`, `volkov_investigated`, `identified_eva`, `eva_contacted`, `sstv_decoded`, `picked_up_usb`, `visited_mancave`, `mother_call_count`, `father_call_count` |

### sdr_bench
| Property | Value |
|----------|-------|
| **File** | `scenes/sdr_bench/scene.js` (~230 lines) |
| **onEnter** | âœ… Sets `visited_sdr_bench`, adds quest `decode_sstv_signal` |
| **onExit** | âœ… (empty) |
| **Transitions OUT** | `mancave` (hotspot `back_to_mancave`, via `targetScene`) |
| **Transitions IN** | `mancave` |
| **setStoryPart** | â€” |
| **Flags set** | `visited_sdr_bench`, `sstv_decoded`, `sstv_coordinates_known` |
| **Flags checked** | `sstv_decoded`, `sstv_transmission_received` |

### garden
| Property | Value |
|----------|-------|
| **File** | `scenes/garden/scene.js` (928 lines) |
| **onEnter** | âœ… Sets `visited_garden` |
| **onExit** | â€” |
| **Transitions OUT** | `home` (hotspot `door-house`), `mancave` (hotspot), driving scenes via Volvo destination picker |
| **Transitions IN** | `home`, `mancave` (2 doors) |
| **setStoryPart** | â€” |
| **Flags set** | `visited_garden`, `driving_destination` (set before driving scene load), `drove_to_facility` |
| **Flags checked** | `klooster_unlocked`, `visited_klooster`, `astron_unlocked`, `visited_astron`, `dwingeloo_unlocked`, `visited_dwingeloo`, `visited_westerbork`, `westerbork_unlocked` |
| **Volvo destinations** | See [Volvo Destination Picker](#volvo-destination-picker) below |

#### Volvo Destination Picker

| Destination | Gate Condition | Driving Scene | Driving Dest | Night? |
|------------|---------------|---------------|-------------|--------|
| Ter Apel Klooster | `klooster_unlocked` | `driving` | `klooster` | Yes |
| ASTRON / WSRT | `astron_unlocked` | `driving_day` | `astron` | No |
| Steckerdoser Heide | `questManager.hasQuest('infiltrate_facility')` | `driving` | `facility` | Yes |
| Dwingeloo Observatory | `dwingeloo_unlocked` OR `visited_astron` | â€” (direct) | â€” | No |
| Westerbork Memorial | `visited_klooster` OR `westerbork_unlocked` | â€” (direct) | â€” | No |

**Note:** Visited destinations are greyed out and unclickable. If ALL destinations are visited, the picker says "Already been everywhere."

### driving
| Property | Value |
|----------|-------|
| **File** | `scenes/driving/scene.js` (589 lines) |
| **onEnter** | âœ… Reads `driving_destination` flag, starts monologue + audio |
| **onExit** | âœ… Stops audio |
| **Transitions OUT** | Depends on `driving_destination` flag: |
| | `'klooster'` â†’ `setStoryPart(7)`, `loadScene('klooster')` |
| | `'facility'` â†’ `setStoryPart(17)`, `loadScene('facility')` |
| | `'home'` â†’ `loadScene('mancave')` |
| | `'astron'` â†’ `loadScene('astron')` |
| | `'home_from_astron'` â†’ `loadScene('mancave')` |
| | default â†’ `loadScene('mancave')` |
| **Transitions IN** | `garden` (Volvo picker) |
| **setStoryPart** | 7 (klooster route), 17 (facility route) |
| **Flags set** | Clears `driving_destination` to null |
| **Flags checked** | `driving_destination` |

### driving_day
| Property | Value |
|----------|-------|
| **File** | `scenes/driving_day/scene.js` (533 lines) |
| **onEnter** | âœ… Reads `driving_destination` flag, starts RTV Drenthe radio |
| **onExit** | âœ… Stops radio |
| **Transitions OUT** | Depends on `driving_destination` flag: |
| | `'astron'` â†’ `loadScene('astron')` |
| | `'home_from_astron'` â†’ `loadScene('mancave')` |
| | default â†’ `loadScene('mancave')` |
| **Transitions IN** | `garden` (Volvo picker) |
| **setStoryPart** | â€” |
| **Flags set** | Clears `driving_destination` to null |
| **Flags checked** | `driving_destination` |

### klooster
| Property | Value |
|----------|-------|
| **File** | `scenes/klooster/scene.js` (692 lines) |
| **onEnter** | âœ… (audio setup) |
| **onExit** | â€” |
| **Transitions OUT** | `car_discovery` (hotspot `volvo`, if !found_usb_stick or !picked_up_usb), `driving` with dest='home' (hotspot `volvo`, if picked_up_usb), `westerbork_memorial` (hotspot `westerbork-sign`, after dialogue) |
| **Transitions IN** | `driving` (destination='klooster'), `westerbork_memorial` (hotspot `back_to_klooster`) |
| **setStoryPart** | â€” |
| **Flags set** | `checked_courtyard`, `found_usb_stick`, `driving_destination` ('home') |
| **Flags checked** | `found_usb_stick`, `picked_up_usb` |

### car_discovery
| Property | Value |
|----------|-------|
| **File** | `scenes/car_discovery/scene.js` (~160 lines) |
| **onEnter** | âœ… Sets `saw_usb_first_time` |
| **onExit** | âœ… |
| **Transitions OUT** | `driving` with dest='home' (hotspot `car`, "Get in Car" â€” requires `picked_up_usb`) |
| **Transitions IN** | `klooster` (Volvo hotspot) |
| **setStoryPart** | â€” |
| **Flags set** | `saw_usb_first_time`, `picked_up_usb`, `driving_destination` ('home') |
| **Flags checked** | `picked_up_usb` |

### astron
| Property | Value |
|----------|-------|
| **File** | `scenes/astron/scene.js` (448 lines) |
| **onEnter** | âœ… Sets `visited_astron`, shows Cees Bassa NPC |
| **onExit** | âœ… |
| **Transitions OUT** | `driving_day` with dest='home_from_astron' (hotspot `door-exit`, requires `astron_complete`) |
| **Transitions IN** | `driving` (dest='astron') or `driving_day` (dest='astron') |
| **setStoryPart** | â€” |
| **Flags set** | `visited_astron`, `schematics_verified`, `signal_triangulated`, `astron_complete`, `facility_unlocked`, `driving_destination` ('home_from_astron') |
| **Flags checked** | `schematics_verified`, `signal_triangulated`, `astron_complete` |
| **Puzzle** | Frequency entry: `243` â†’ sets `signal_triangulated` |
| **Quest** | Adds `infiltrate_facility` quest (line 352) |

### dwingeloo
| Property | Value |
|----------|-------|
| **File** | `scenes/dwingeloo/scene.js` (~175 lines) |
| **onEnter** | âœ… Sets `visited_dwingeloo` |
| **onExit** | âœ… (empty) |
| **Transitions OUT** | `regional_map` (hotspot `back_to_map`) |
| **Transitions IN** | `garden` (Volvo picker, direct), `regional_map` |
| **setStoryPart** | â€” |
| **Flags set** | `visited_dwingeloo`, `dwingeloo_broadcast_found`, `zerfall_duration_known`, `dwingeloo_transmitter_found` |
| **Flags checked** | â€” |

### westerbork_memorial
| Property | Value |
|----------|-------|
| **File** | `scenes/westerbork_memorial/scene.js` (~230 lines) |
| **onEnter** | âœ… Sets `visited_westerbork_memorial` |
| **onExit** | âœ… (empty) |
| **Transitions OUT** | `klooster` (hotspot `back_to_klooster`), `regional_map` (hotspot `back_to_map`) |
| **Transitions IN** | `klooster` (westerbork-sign hotspot), `garden` (Volvo picker, direct), `regional_map` |
| **setStoryPart** | â€” |
| **Flags set** | `visited_westerbork_memorial`, `westerbork_camera_inspected`, `westerbork_bt_cracked`, `zerfall_network_mapped`, `bt_camera_quest_started` |
| **Flags checked** | `westerbork_camera_inspected`, `westerbork_bt_cracked` |
| **Items checked** | `flipper_zero` (required for BT scan of modified camera) |

### planboard
| Property | Value |
|----------|-------|
| **File** | `scenes/planboard/scene.js` (1091 lines) |
| **onEnter** | âœ… Creates evidence overlays |
| **onExit** | âœ… Cleans up overlays |
| **Transitions OUT** | `mancave` (hotspot `back-button`, line 955/963) |
| **Transitions IN** | `mancave` (investigation-board hotspot) |
| **setStoryPart** | â€” |
| **Flags set** | â€” |
| **Flags checked** | `sstv_decoded`, `picked_up_usb`, `usb_analyzed`, `viewed_schematics`, `visited_videocall` |

### regional_map
| Property | Value |
|----------|-------|
| **File** | `scenes/regional_map/scene.js` (~450 lines) |
| **onEnter** | âœ… |
| **onExit** | âœ… |
| **Transitions OUT** | `mancave` (hotspot `back-button`), `dwingeloo` (hotspot `location-dwingeloo-hotspot`), `westerbork_memorial` (hotspot `location-westerbork-memorial-hotspot`) |
| **Transitions IN** | `mancave` (regional-map hotspot), `dwingeloo` (back_to_map), `westerbork_memorial` (back_to_map) |
| **setStoryPart** | â€” |
| **Flags set** | â€” |
| **Flags checked** | Various (for showing/hiding location markers) |

### videocall
| Property | Value |
|----------|-------|
| **File** | `scenes/videocall/scene.js` (~220 lines) |
| **onEnter** | âœ… Sets `visited_videocall` |
| **onExit** | âœ… (empty) |
| **Transitions OUT** | `mancave` (hotspot `exit_videocall`) |
| **Transitions IN** | `mancave` (video-terminal hotspot) |
| **setStoryPart** | â€” |
| **Flags set** | `visited_videocall` |
| **Flags checked** | â€” |

### facility
| Property | Value |
|----------|-------|
| **File** | `scenes/facility/scene.js` (~290 lines) |
| **onEnter** | âœ… Sets `visited_facility`, checks storyPart â‰¥ 17 |
| **onExit** | âœ… (empty) |
| **Transitions OUT** | `facility_interior` (hotspot `control_panel`, requires gate opened: `flipper_zero` + `security_badge`) |
| **Transitions IN** | `driving` (destination='facility') |
| **setStoryPart** | 18 (gate opened) |
| **Flags set** | `visited_facility`, `badge_cloned` |
| **Flags checked** | `storyPart >= 17` |
| **Items checked** | `flipper_zero`, `security_badge` |
| **Items added** | `security_badge` (found under trash bin at facility entrance) |
| **Quest** | Updates `infiltrate_facility` progress: `badge_acquired`, `camera_disabled`, `gate_opened` |

### facility_interior
| Property | Value |
|----------|-------|
| **File** | `scenes/facility_interior/scene.js` (~160 lines) |
| **onEnter** | âœ… Sets `facility_interior_entered`, `entered_facility` |
| **onExit** | âœ… (empty) |
| **Transitions OUT** | `facility_server` (hotspot `basement_stairs`, requires internal `basementUnlocked` state) |
| **Transitions IN** | `facility` (control_panel hotspot) |
| **setStoryPart** | â€” |
| **Flags set** | `facility_interior_entered`, `entered_facility` |
| **Flags checked** | Internal `basementUnlocked` state |

### facility_server
| Property | Value |
|----------|-------|
| **File** | `scenes/facility_server/scene.js` (1250 lines) |
| **onEnter** | âœ… Massive 6-phase cinematic (server hack â†’ evidence download â†’ confrontation with Volkov â†’ Kubecka/Eva arrive â†’ aftermath) |
| **onExit** | âœ… Full cleanup |
| **Transitions OUT** | `debrief` (line 1218, after Phase 6 CONTINUE button + epilogue dialogue) |
| **Transitions IN** | `facility_interior` (basement_stairs hotspot) |
| **setStoryPart** | 19 (line 866, evidence gathered), 20 (line 1170, operation neutralised) |
| **Flags set** | `data_extracted`, `collected_evidence`, `kubecka_arrived`, `eva_arrived` |
| **Quest** | Completes `infiltrate_facility` |

### debrief
| Property | Value |
|----------|-------|
| **File** | `scenes/debrief/scene.js` (~230 lines) |
| **onEnter** | âœ… Sets `visited_debrief`, starts multi-part debrief dialogue |
| **onExit** | âœ… Clears timeouts |
| **Transitions OUT** | `epilogue` (hotspot `continue-to-epilogue` if `debrief_complete`, ALSO auto after 10s timeout) (lines 84, 245) |
| **Transitions IN** | `facility_server` |
| **setStoryPart** | â€” |
| **Flags set** | `visited_debrief`, `debrief_complete` |
| **Flags checked** | `debrief_complete` |

### epilogue
| Property | Value |
|----------|-------|
| **File** | `scenes/epilogue/scene.js` (~200 lines) |
| **onEnter** | âœ… Sets `visited_epilogue`, plays multi-part epilogue |
| **onExit** | âœ… |
| **Transitions OUT** | `credits` (hotspot `continue-to-credits` if `epilogue_complete`, ALSO auto after 8s timeout) (lines 41, 177) |
| **Transitions IN** | `debrief` |
| **setStoryPart** | â€” |
| **Flags set** | `visited_epilogue`, `epilogue_complete` |
| **Flags checked** | `epilogue_complete` |

### credits
| Property | Value |
|----------|-------|
| **File** | `scenes/credits/scene.js` (973 lines) |
| **onEnter** | âœ… 7-act cinematic credits (star field, scrolling credits, THANK YOU FOR PLAYING) |
| **onExit** | âœ… Full cleanup |
| **Transitions OUT** | `window.location.reload()` ("RETURN TO TITLE" button in Act 7) â€” **no loadScene call** |
| **Transitions IN** | `epilogue` |
| **setStoryPart** | â€” |
| **Flags set** | â€” |
| **Flags checked** | â€” |
| **Terminal scene** | Yes â€” game ends here, reload restarts from scratch |

---

## 4. Flag Registry

### Progression Flags (gate scene transitions)

| Flag | Set in | Checked in | Purpose |
|------|--------|-----------|---------|
| `made_espresso` | home | home | Unlocks post-espresso dialogues |
| `tv_documentary_watched` | tvdocumentary | home, livingroom | Gates mancave access from home |
| `documentary_completed_once` | tvdocumentary | livingroom | Skip-related behavior |
| `klooster_unlocked` | mancave | garden (Volvo), mancave | Enables Klooster destination |
| `astron_unlocked` | mancave (ally-recruitment) | garden (Volvo) | Enables ASTRON destination |
| `facility_unlocked` | astron | â€” (âš ï¸ see issues) | Set but not directly checked |
| `sstv_decoded` | sdr_bench | mancave, planboard | SDR decode complete |
| `picked_up_usb` | car_discovery | klooster, car_discovery, mancave, planboard | USB stick in possession |
| `usb_analyzed` | mancave (usb-analysis) | planboard | USB contents examined |
| `evidence_unlocked` | mancave (usb-analysis) | mancave | Unlocks further investigation |
| `started_ally_search` | mancave (dilemma) | mancave | Gates ally recruitment |
| `contacted_allies` | mancave (ally-recruitment) | mancave | Some allies contacted |
| `all_allies_contacted` | mancave (ally-recruitment) | mancave | All allies ready |
| `volkov_investigated` | mancave (volkov-investigation) | mancave | Intel on antagonist |
| `identified_eva` | mancave (eva-reveal) | mancave | Whistleblower identity known |
| `eva_contacted` | mancave (eva-contact) | mancave | Eva contacted via Meshtastic |
| `astron_complete` | astron | astron | Enables exit from ASTRON |
| `visited_astron` | astron | garden (Volvo â€” Dwingeloo unlock) | Unlocks Dwingeloo as side trip |
| `visited_klooster` | klooster (implied) | garden (Volvo â€” Westerbork unlock) | Unlocks Westerbork Memorial |
| `driving_destination` | garden (Volvo picker) | driving, driving_day | Routes driving scenes |
| `drove_to_facility` | garden (Volvo picker onSelect) | garden (Volvo â€” visited check) | Facility already visited |
| `debrief_complete` | debrief | debrief | Gates epilogue transition |
| `epilogue_complete` | epilogue | epilogue | Gates credits transition |

### Informational Flags (set/read but don't gate progression)

`visited_livingroom`, `saw_tv_documentary`, `talked_to_ies`, `dog_interactions`, `post_documentary_reminder_shown`, `fireplace_interactions`, `pug_interactions`, `visited_mancave`, `visited_sdr_bench`, `visited_garden`, `checked_email`, `message_decoded`, `frequency_tuned`, `military_frequency`, `second_transmission_ready`, `second_message_decoded`, `sstv_transmission_received`, `saw_usb_first_time`, `visited_facility`, `facility_interior_entered`, `entered_facility`, `badge_cloned`, `data_extracted`, `collected_evidence`, `kubecka_arrived`, `eva_arrived`, `visited_debrief`, `visited_epilogue`, `visited_dwingeloo`, `visited_westerbork_memorial`, `visited_videocall`, `checked_courtyard`, `found_usb_stick`, `schematics_verified`, `signal_triangulated`, `sstv_coordinates_known`, `henk_contacted`, `cees_contacted`, `jaap_contacted`, `contacted_kubecka`, `discovered_zerfall`, `espresso_count`, `mother_call_count`, `father_call_count`, `dwingeloo_broadcast_found`, `zerfall_duration_known`, `dwingeloo_transmitter_found`, `westerbork_camera_inspected`, `westerbork_bt_cracked`, `zerfall_network_mapped`, `bt_camera_quest_started`

---

## 5. Dead Ends & Navigation Issues

### âœ… No True Dead Ends Found

All scenes have at least one exit path:

| Scene | Exit Mechanism |
|-------|---------------|
| planboard | `back-button` hotspot â†’ mancave (line 955) |
| videocall | `exit_videocall` hotspot â†’ mancave |
| sdr_bench | `back_to_mancave` hotspot â†’ mancave |
| dwingeloo | `back_to_map` hotspot â†’ regional_map |
| westerbork_memorial | `back_to_klooster` + `back_to_map` hotspots |
| regional_map | `back-button` â†’ mancave + location hotspots |
| credits | "RETURN TO TITLE" button â†’ `window.location.reload()` |
| intro | Auto-transitions to home |
| driving/driving_day | Auto-transitions after timed dialogue |

### âš ï¸ Potential Soft Locks

1. **car_discovery**: If the player enters but does NOT pick up the USB stick, the "Get in Car" hotspot checks `picked_up_usb` before allowing departure. The player must click the USB item first. **No alternative exit is evident** â€” this could be a soft lock if the USB hotspot is not found or clicked. (Need to verify car_discovery has a back/exit hotspot beyond the car.)

2. **astron**: The `door-exit` hotspot requires `astron_complete` flag. If the player doesn't complete all tasks (verify schematics, triangulate signal), they cannot leave. This is intentional gating but could feel like a soft lock if the player is stuck on the frequency puzzle (answer: 243).

3. **facility â†’ facility_interior â†’ facility_server**: This is a one-way chain. Once you enter facility via driving, there is no "drive back" option. The player must complete the infiltration to proceed. This is **intentional** (narrative climax).

---

## 6. Unreachable Scenes

### âœ… All 23 Scenes Are Reachable

Every scene has at least one incoming `loadScene` call or `targetScene` reference:

| Scene | Reached from |
|-------|-------------|
| intro | Game start |
| home | intro, livingroom, garden, mancave |
| livingroom | home, tvdocumentary |
| tvdocumentary | livingroom |
| mancave | home, driving, driving_day, garden, sdr_bench, videocall, planboard, regional_map |
| sdr_bench | mancave |
| garden | home, mancave |
| driving | garden (Volvo), klooster (with dest='home') |
| driving_day | garden (Volvo) |
| klooster | driving (dest='klooster'), westerbork_memorial (back_to_klooster) |
| car_discovery | klooster |
| astron | driving/driving_day (dest='astron') |
| dwingeloo | garden (direct), regional_map |
| westerbork_memorial | klooster, garden (direct), regional_map |
| planboard | mancave |
| regional_map | mancave, dwingeloo, westerbork_memorial |
| videocall | mancave |
| facility | driving (dest='facility') |
| facility_interior | facility |
| facility_server | facility_interior |
| debrief | facility_server |
| epilogue | debrief |
| credits | epilogue |

---

## 7. Flag Mismatches & Unused Flags

### ğŸ”´ `dwingeloo_unlocked` â€” NEVER SET

- **Checked in:** `garden/scene.js:487` (`game.getFlag('dwingeloo_unlocked') || game.getFlag('visited_astron')`)
- **Set in:** NOWHERE in the entire codebase
- **Impact:** LOW â€” Dwingeloo is still reachable via the `visited_astron` fallback condition.
- **Recommendation:** Either remove the `dwingeloo_unlocked` check or add a `setFlag('dwingeloo_unlocked', true)` somewhere (e.g., after discovering Zerfall or in the Volkov investigation).

### ğŸ”´ `westerbork_unlocked` â€” NEVER SET

- **Checked in:** `garden/scene.js:502` (`game.getFlag('visited_klooster') || game.getFlag('westerbork_unlocked')`)
- **Set in:** NOWHERE in the entire codebase
- **Impact:** LOW â€” Westerbork Memorial is reachable via `visited_klooster` fallback AND via klooster's `westerbork-sign` hotspot AND via `regional_map`.
- **Recommendation:** Either remove the `westerbork_unlocked` check or set it somewhere to provide an alternate unlock path.

### ğŸŸ¡ `facility_unlocked` â€” SET BUT NEVER CHECKED (as a flag)

- **Set in:** `astron/scene.js` (`game.setFlag('facility_unlocked', true)`)
- **Checked in:** NOWHERE as a `getFlag` call
- **Note:** The facility destination in the Volvo picker is gated by `questManager.hasQuest('infiltrate_facility')`, NOT by the `facility_unlocked` flag.
- **Impact:** MEDIUM â€” The flag is set but serves no purpose. The quest `infiltrate_facility` is the actual gate.
- **Recommendation:** Remove `setFlag('facility_unlocked', true)` from astron, or use it as the gate condition in garden instead of the quest check.

### ğŸŸ¡ `visited_westerbork` vs `visited_westerbork_memorial` â€” NAMING INCONSISTENCY

- **Set:** `visited_westerbork_memorial` (in `westerbork_memorial/scene.js`)
- **Checked in garden Volvo picker:** `game.getFlag('visited_westerbork')` (line 508: `visited: !!game.getFlag('visited_westerbork')`)
- **Impact:** MEDIUM â€” The Westerbork destination in the Volvo picker will never show as "Visited" because it checks the wrong flag name. The player could theoretically re-drive there (though the `directScene` path makes this moot since visited destinations are only greyed out, not blocked).

---

## 8. Story Part Gaps

### âœ… No Numerical Gaps

Values 0 through 20 are all assigned. The debug panel in `engine/game.js:1453` only shows buttons for 0â€“18, but values 19 and 20 are set by `facility_server`.

### âš ï¸ StoryPart is Not Checked for Sequencing

The `storyPart` value is only checked in one place:
- `facility/scene.js:48` â€” hotspot `enabled` check: `game.gameState.storyPart >= 17`
- `facility/scene.js:378-394` â€” `onEnter` dialogue branching based on `storyPart === 17`

All other progression is managed by **flags**, not storyPart. The storyPart is essentially a progress indicator for the debug panel, not a gate mechanism.

---

## 9. Item Inventory Flow

| Item ID | Added In | Used/Checked In |
|---------|----------|----------------|
| `flipper_zero` | `mancave/scene.js:380` (Flipper Zero hotspot) | `facility/scene.js:132,249` (camera disable + gate open), `westerbork_memorial/scene.js:74` (BT scan) |
| `security_badge` | `facility/scene.js:62` (trash bin at entrance) | `facility/scene.js:236,249` (gate open requires both items) |

**Flow:** Player must pick up Flipper Zero in mancave â†’ (optionally use at Westerbork) â†’ drive to facility â†’ find badge â†’ use Flipper + badge to open gate.

---

## 10. Scene Graph (Adjacency)

```
intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ home
                                     â†•
                              livingroom â†â†’ tvdocumentary
                                     â†•
                                   garden â†â†’ mancave
                                     â”‚         â†•â†•â†•â†•â†•
                                     â”‚    sdr_bench  videocall  planboard  regional_map  home
                                     â”‚                                        â†•â†•
                                     â”‚                              dwingeloo  westerbork_memorial
                                     â”‚                                              â†•
                              [Volvo picker]                                   klooster
                                     â”‚                                         â†•
                                     â”œâ”€â”€â”€â†’ driving â”€â”€â”€â”€â†’ klooster â”€â”€â”€â”€â†’ car_discovery
                                     â”‚                       â†•                 â”‚
                                     â”‚              westerbork_memorial         â”‚
                                     â”‚                                         â†“
                                     â”‚                                   driving(home) â†’ mancave
                                     â”‚
                                     â”œâ”€â”€â”€â†’ driving_day â†’ astron â†’ driving_day(home) â†’ mancave
                                     â”‚
                                     â”œâ”€â”€â”€â†’ dwingeloo (direct)
                                     â”œâ”€â”€â”€â†’ westerbork_memorial (direct)
                                     â”‚
                                     â””â”€â”€â”€â†’ driving(facility) â†’ facility â†’ facility_interior
                                                                              â”‚
                                                                       facility_server
                                                                              â”‚
                                                                           debrief
                                                                              â”‚
                                                                           epilogue
                                                                              â”‚
                                                                           credits
                                                                              â”‚
                                                                     [window.reload()]
```

---

## Summary of Issues Found

| # | Severity | Issue | Location |
|---|----------|-------|----------|
| 1 | ğŸ”´ | `dwingeloo_unlocked` flag checked but never set | garden/scene.js:487 |
| 2 | ğŸ”´ | `westerbork_unlocked` flag checked but never set | garden/scene.js:502 |
| 3 | ğŸŸ¡ | `facility_unlocked` flag set but never checked | astron/scene.js |
| 4 | ğŸŸ¡ | `visited_westerbork` vs `visited_westerbork_memorial` naming mismatch | garden/scene.js:508 vs westerbork_memorial/scene.js |
| 5 | ğŸŸ¡ | Debug panel storyPart buttons only go to 18, but game uses 19â€“20 | engine/game.js:1453 |
| 6 | âšª | car_discovery may lack a "go back to klooster" exit if USB not found | scenes/car_discovery/scene.js |
| 7 | âšª | Credits "RETURN" does `window.location.reload()` â€” no save state preserved | scenes/credits/scene.js |

---

*End of analysis.*
